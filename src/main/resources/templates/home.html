<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="template_layout_navbar">
<head>
    <title>Transférer</title>
    <link rel="stylesheet" href="/webjars/bootstrap/5.3.3/css/bootstrap.min.css">
</head>
<body>
<div layout:fragment="content1">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <!-- Account Balance Card -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h2 class="card-title text-center">Current Balance</h2>
                        <h3 class="text-center text-primary">
                            <span th:text="${#numbers.formatDecimal(balance, 1, 2)}">0.00</span> €
                        </h3>
                    </div>
                </div>

                <!-- Alerts -->
                <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
                    <span th:text="${successMessage}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                    <span th:text="${errorMessage}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>

                <!-- Transfer Money Card -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h3 class="card-title mb-0">Make a Transfer</h3>
                    </div>
                    <div class="card-body">
                        <form th:action="@{/account/transfer}" method="post">
                            <!--<div class="mb-3">
                                <label for="receiverEmail" class="form-label">Receiver Email</label>
                                <input type="email"
                                       class="form-control"
                                       id="receiverEmail"
                                       name="receiverEmail"
                                       placeholder="friend@example.com"
                                       required>
                            </div>
                            <select id="cars">
                            <option value="volvo">Volvo</option>
                            <option value="saab">Saab</option>
                            <option value="opel">Opel</option>
                            <option value="audi">Audi</option>
                            </select>
                            -->
                            <div th:if="${friendList.friends.isEmpty()}" class="text-center py-5">
                                <i class="bi bi-people" style="font-size: 3rem;"></i>
                                <p class="mt-3">You haven't added any friends yet.</p>
                                <a href="/add-friend" class="btn btn-primary">Add Your First Friend</a>
                            </div>

                            <div th:if="!${friendList.friends.isEmpty()}" class="mb-3">
                                <label for="receiverEmail">Choose a friend:</label>
                                <div>
                                    <select class=""
                                            id="receiverEmail"
                                            name="receiverEmail">
                                        <option th:each="friend : ${friendList.friends}"
                                                th:text="${friend.email}"
                                                th:value="${friend.email}">
                                    </select>
                                </div>
                            </div>
                            <div th:if="!${friendList.friends.isEmpty()}" class="mb-3
                                  ">
                                <label for="amount" class="form-label">Amount (€)</label>
                                <input type="number"
                                       class="form-control"
                                       id="amount"
                                       name="amount"
                                       step="0.01"
                                       min="0.01"
                                       placeholder="0.00"
                                       required>
                            </div>
                            <div th:if="!${friendList.friends.isEmpty()}" class="mb-3">
                                <label for="description" class="form-label">Description</label>
                                <input type="text"
                                       class="form-control"
                                       id="description"
                                       name="description"
                                       placeholder="Enter transfer description"
                                       required>
                            </div>
                            <div th:if="!${friendList.friends.isEmpty()}" class="d-grid">
                                <button type="submit" class="btn btn-primary">Transfer Money</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Deposit Money Card -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title mb-0">Deposit Money</h3>
                    </div>
                    <div class="card-body">
                        <form th:action="@{/account/deposit}" method="post">
                            <div class="mb-3">
                                <label for="depositAmount" class="form-label">Amount (€)</label>
                                <input type="number"
                                       class="form-control"
                                       id="depositAmount"
                                       name="amount"
                                       step="0.01"
                                       min="0.01"
                                       placeholder="0.00"
                                       required>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-success">Deposit</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Optional: Recent Transactions -->
                <div class="card mt-4" th:if="${transactions != null and not #lists.isEmpty(transactions)}">
                    <div class="card-header">
                        <h3 class="card-title mb-0">Recent Transactions</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Receiver</th>
                                    <th>Amount</th>
                                    <th>Description</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="transaction : ${transactions}">
                                    <td th:text="${transaction.senderId == #authentication.principal.id ? 'Sent' : 'Received'}">
                                        Type
                                    </td>
                                    <!-- todo : how to properly get the receiver username and/or email ? should I use transactionListDTO ?-->
                                    <td th:text="${transaction.receiverId}">
                                        Receiver
                                    </td>
                                    <td th:text="${#numbers.formatDecimal(transaction.amount, 1, 2) + ' €'}">0.00 €</td>
                                    <td th:text="${transaction.description}">Description</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="/webjars/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
</body>
</html>
